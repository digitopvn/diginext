import { IsNotEmpty } from "class-validator";
import { makeSlug } from "diginext-utils/dist/Slug";

import type { ObjectID } from "@/libs/typeorm";
import { Column, Entity, ObjectIdColumn } from "@/libs/typeorm";

import type { IBase } from "./Base";
import Base from "./Base";
import type Role from "./Role";
import type { User } from "./User";

export interface IWorkspace extends IBase {
	name: string;
	image?: string;
	owner?: ObjectID | User;
}

export class WorkspaceApiAccessToken {
	/**
	 * Workspace name
	 */
	name: string;

	/**
	 * Is also a subdomain of *.diginext.site
	 * @example <slug>.diginext.site
	 */
	slug?: string;

	/**
	 * Custom domain of a workspace
	 */
	domain?: string;

	/**
	 *
	 */
	token: string;

	/**
	 *
	 */
	roles?: Role[];

	constructor(data?: any) {
		if (data.name) this.slug = makeSlug(data.name);
		return Object.assign(this, data);
	}
}

@Entity({ name: "workspaces" })
export default class Workspace extends Base {
	/**
	 * Workspace name
	 */
	@Column({ length: 250 })
	@IsNotEmpty({ message: `Workspace name is required.` })
	name?: string;

	/**
	 * Workspace slug: auto-generated by "name" column
	 * @readonly
	 */
	@Column({ length: 250 })
	@IsNotEmpty({ message: `Workspace slug is required.` })
	slug?: string;

	/**
	 * Is this a `public` workspace that anyone can join, otherwise it's a `private` workspace that needs approval on joining request.
	 */
	@Column({ type: "boolean", default: false })
	public?: boolean;

	/**
	 * Workspace profile picture
	 */
	@Column()
	image?: string;

	/**
	 * Workspace domain name
	 */
	@Column()
	domain?: string;

	/**
	 * List of this workspace's API Access Token
	 */
	// @Column()
	// apiAccessTokens?: WorkspaceApiAccessToken[];

	/**
	 * User ID of the owner
	 *
	 * @remarks This can be populated to {User} data
	 */
	@ObjectIdColumn({ name: "users" })
	owner?: ObjectID | User | string;

	constructor(data?: any) {
		super();
		return Object.assign(this, data);
	}
}

export { Workspace };
