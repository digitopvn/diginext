"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[202],{45669:function(e,t,n){n.d(t,{Wk:function(){return y},aC:function(){return j},x4:function(){return p}});var i=n(85893),r=n(50888),s=n(67848),l=n(85945),a=n(99138),o=n(78945),c=n(47041),u=n(96486),d=n(11163),h=n(67294),g=n(69931),x=n(25026),m=n(91144),v=n(51369);let p=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null!==(e=t.redirectURL)&&void 0!==e?e:v.De.NEXT_PUBLIC_API_BASE_URL;window.location.href="".concat(v.De.NEXT_PUBLIC_API_BASE_URL,"/auth/google?redirect_url=").concat(n)},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{access_token:t=(0,c.getCookie)("x-auth-cookie")}=e,n=(0,d.useRouter)();return(0,s.a)({staleTime:12e4,queryKey:["auth"],queryFn:async()=>{var e;let i=new URLSearchParams(n.asPath.split("?")[1]),r=Object.fromEntries(i),{access_token:s}=r,l=null!==(e=null!=t?t:(0,c.getCookie)("x-auth-cookie"))&&void 0!==e?e:s,{data:a}=await o.Z.get("".concat(v.De.NEXT_PUBLIC_API_BASE_URL,"/auth/profile"),{headers:l?{Authorization:"Bearer ".concat(l)}:{}});return a}})},j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{redirectUrl:t}=e,n=(0,d.useRouter)(),[i]=(0,x.o)(),{access_token:r=(0,c.getCookie)("x-auth-cookie")}=i;r&&(0,c.setCookie)("x-auth-cookie",r);let{data:s,isError:a,isFetched:o,isLoading:u,isSuccess:g}=f({access_token:r}),{status:m,data:v}=s||{},p=(0,l.NL)(),j=async()=>{await p.invalidateQueries({queryKey:["auth"]})};return(0,h.useEffect)(()=>{void 0!==m&&!1!==o&&setTimeout(()=>{let e=(0,c.getCookie)("x-auth-cookie");e&&m?j():n.push(t?"/login?redirect_url=".concat(t):"/login")},200)},[m]),[v,{reload:j,isError:a,isLoading:u,isFetched:o,isSuccess:g,status:m}]},y=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{children:n}=t;(0,d.useRouter)();let[s,{isLoading:l,isFetched:o}]=j(),{workspaces:c=[]}=s||{},h=null===(e=c[0])||void 0===e?void 0:e.slug,x=(0,m.c)({name:h});return l?(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(r.Z,{}),(0,i.jsx)("span",{className:"ml-2",children:"Loading..."})]}):o&&(0,u.isEmpty)(s)?(0,i.jsx)(i.Fragment,{}):x?(0,i.jsx)(i.Fragment,{children:n}):(0,i.jsx)(g.Z,{className:"text-center",children:(0,i.jsx)(a.Z,{message:"Error",description:"This workspace does not exists.",type:"error"})})}},12780:function(e,t,n){n.d(t,{BY:function(){return r},wl:function(){return s}});var i=n(14223);let r=e=>(0,i.wz)(["builds","list"],"/api/v1/build",e),s=(e,t)=>(0,i.AQ)(["builds","logs",e],"/api/v1/build/logs",e,t)},84435:function(e,t,n){n.d(t,{CN:function(){return l},pD:function(){return s},ve:function(){return a},x7:function(){return r}});var i=n(14223);let r=e=>(0,i.wz)(["clusters","list"],"/api/v1/cluster",e),s=(e,t)=>(0,i.AQ)(["clusters",e],"/api/v1/cluster",e,t),l=()=>(0,i.FF)(["clusters","create"],"/api/v1/cluster"),a=e=>(0,i.yt)(["clusters","update"],"/api/v1/cluster",e)},51855:function(e,t,n){n.d(t,{av:function(){return s},xh:function(){return r}});var i=n(14223);let r=(e,t)=>(0,i.AQ)(["workspaces",e],"/api/v1/workspace",e,t),s=e=>(0,i.FF)(["workspaces"],"/api/v1/workspace",e)},14223:function(e,t,n){n.d(t,{AQ:function(){return h},FF:function(){return g},TV:function(){return m},wz:function(){return d},yt:function(){return x}});var i=n(85945),r=n(67848),s=n(48228),l=n(78945),a=n(47041),o=n(96486),c=n(11163),u=n(51369);let d=function(e,t){var n;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=(0,c.useRouter)(),h=null!==(n=d.query.access_token)&&void 0!==n?n:(0,a.getCookie)("x-auth-cookie"),g=h?{Authorization:"Bearer ".concat(h)}:{},{pagination:x={page:1,size:20},populate:m,filter:v,sort:p="-updatedAt,-createdAt"}=s,f=new URLSearchParams(x).toString(),j=m?"populate=".concat(m):"",y=v?new URLSearchParams(v).toString():"",k="sort=".concat(p),Z=(0,i.NL)(),_=[...e];return(0,o.isEmpty)(v)||_.push(v),(0,o.isEmpty)(x)||_.push(x),(0,r.a)({queryKey:_,queryFn:async()=>{let{data:n}=await l.Z.get("".concat(u.De.NEXT_PUBLIC_API_BASE_URL).concat(t,"?").concat(y,"&").concat(k,"&").concat(j,"&").concat(f),{...s,headers:g}),{current_page:i,total_pages:r,total_items:o,page_size:c,next_page:d,prev_page:h,...x}=n,{token:m={}}=x;return m.access_token&&(0,a.setCookie)("x-auth-cookie",m.access_token),console.log("data :>> ",n),{list:n.data.map(t=>(Z.setQueryData([...e,t._id],t),Z.setQueryData([...e,{slug:t.slug}],t),{...t,key:t._id}))||[],pagination:{current_page:i,total_pages:r,total_items:o,page_size:c,next_page:d,prev_page:h}}}})},h=function(e,t,n){var i;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},d=(0,c.useRouter)(),h=null!==(i=d.query.access_token)&&void 0!==i?i:(0,a.getCookie)("x-auth-cookie"),g=h?{Authorization:"Bearer ".concat(h)}:{},{populate:x,filter:m={}}=s;m.slug=n;let v=x?"populate=".concat(x):"",p=new URLSearchParams(m).toString();return(0,r.a)({enabled:null!=n,queryKey:e,queryFn:async()=>{let e="".concat(u.De.NEXT_PUBLIC_API_BASE_URL).concat(t,"?").concat(p,"&").concat(v),{data:n}=await l.Z.get(e,{...s,headers:g}),{token:i={}}=n;return(i.access_token&&(0,a.setCookie)("x-auth-cookie",i.access_token),(0,o.isArray)(n.data))?n.data.map(e=>({...e,key:e._id}))[0]:(0,o.isString)(n.data)?n.data:n.data[0]}})},g=function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,c.useRouter)(),d=(0,i.NL)(),h=null!==(n=o.query.access_token)&&void 0!==n?n:(0,a.getCookie)("x-auth-cookie"),g=h?{Authorization:"Bearer ".concat(h)}:{},x=(0,s.D)({mutationFn:async e=>{let n="".concat(u.De.NEXT_PUBLIC_API_BASE_URL).concat(t),{data:i}=await l.Z.post(n,e,{...r,headers:g});return i.data},onMutate:async t=>(await d.cancelQueries({queryKey:e}),t)}),{mutateAsync:m,status:v}=x;return[m,v]},x=function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,c.useRouter)(),d=(0,i.NL)(),h=null!==(n=o.query.access_token)&&void 0!==n?n:(0,a.getCookie)("x-auth-cookie"),g=h?{Authorization:"Bearer ".concat(h)}:{},{pagination:x={page:1,size:20},populate:m,sort:v="-createdAt",filter:p}=r,f=new URLSearchParams(x).toString(),j=p?new URLSearchParams(p).toString():"",y="".concat(u.De.NEXT_PUBLIC_API_BASE_URL).concat(t,"?").concat(j,"&").concat("sort=".concat(v),"&").concat(m?"populate=".concat(m):"","&").concat(f),k=(0,s.D)({mutationFn:async e=>{let{data:t}=await l.Z.patch(y,e,{...r,headers:g});return t.data},onSuccess:(t,n,i)=>{d.invalidateQueries({queryKey:[e[0],"list"]})},onSettled:(e,t,n,i)=>{}});return[k.mutateAsync,k.status]},m=function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,c.useRouter)(),d=(0,i.NL)(),h=null!==(n=o.query.access_token)&&void 0!==n?n:(0,a.getCookie)("x-auth-cookie"),g=h?{Authorization:"Bearer ".concat(h)}:{},x=(0,s.D)({mutationFn:async e=>{let n=new URLSearchParams(e).toString(),i="".concat(u.De.NEXT_PUBLIC_API_BASE_URL).concat(t,"?").concat(n),{data:s}=await l.Z.delete(i,{...r,headers:g});return s},onSuccess:t=>(d.invalidateQueries({queryKey:[e[0],"list"]}),t)}),{mutateAsync:m,status:v}=x;return[m,v]}},69931:function(e,t,n){var i=n(85893);let r=e=>(0,i.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 ".concat(e.className),children:e.children});t.Z=r},77418:function(e,t,n){n.d(t,{q:function(){return c}});var i=n(85893),r=n(83062),s=n(27484),l=n.n(s);n(67294);let a=n(56176),o=n(84110);l().extend(o),l().extend(a);let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{date:t}=e;return(0,i.jsx)(r.Z,{title:l()(t).format("LLL"),children:(0,i.jsx)("span",{children:t?l()(t).fromNow():"-"})})}},46003:function(e,t,n){n.d(t,{O:function(){return _}});var i=n(85893),r=n(50888),s=n(87743),l=n(92195),a=n(33100),o=n(27484),c=n.n(o),u=n(25935),d=n(96486),h=n(11163),g=n(67294),x=n(12780),m=n(25026),v=n(51369);let p=n(57046),f=n(56176),j=n(84110);c().extend(j),c().extend(f);let{useApp:y}=s.Z,k="command failed with exit code 1",Z=e=>"".concat(e).replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,""),_=e=>{let{slug:t}=e;(0,h.useRouter)(),y();let[n]=(0,m.o)(),{build_slug:s}=n,{data:o="",isLoading:c}=(0,x.wl)(null!=t?t:s),f=Z(o),j=f.split("\n").map((e,t)=>e.toString()),_=v.De.NEXT_PUBLIC_API_BASE_URL,[b,w]=(0,g.useState)(["Connecting..."]),[E,S]=(0,g.useState)("in_progress"),[C,N]=(0,g.useState)(!1),{token:{colorText:P}}=l.Z.useToken();return(0,g.useEffect)(()=>{(0,d.isEmpty)(o)||w(j)},[j.length]),(0,g.useEffect)(()=>{let e=o.toString().toLowerCase();if((e.indexOf("finished deploying")>-1||e.indexOf(k)>-1||e.indexOf("[error]")>-1)&&N(!0),e.indexOf("finished deploying")>-1&&S("success"),(e.indexOf(k)>-1||e.indexOf("[error]")>-1)&&S("failed"),!s)return()=>!1;console.log('[socket] connecting to "'.concat(s,'" room...'));let t=p(_,{transports:["websocket"]});return t.on("connect",()=>{console.log("[socket] connected:",t.connected,"(ROOM: ".concat(s,")")),t.emit("join",{room:s}),t.on("message",e=>{let{action:n,message:i}=e;i&&(w(e=>[...e,Z(i)]),((null==i?void 0:i.toLowerCase().indexOf(k))>-1||(null==i?void 0:i.toLowerCase().indexOf("[error]"))>-1)&&(S("failed"),N(!0))),"end"===n&&(t.disconnect(),N(!0),S("success"))})}),t.on("disconnect",()=>{w(e=>[...e,"Disconnected with build server."])}),()=>{t.connected&&t.disconnect(),w([])}},[o]),(0,i.jsxs)("div",{style:{color:P},children:["failed"===E&&(0,i.jsx)("h2",{className:"text-xl text-red-600",children:"Build lỗi rồi m\xe1 ơi!"}),"success"===E&&(0,i.jsx)("h2",{className:"text-xl text-green-600",children:"Build th\xe0nh c\xf4ng rồi, đỉnh qu\xe1 idol ơi!"}),(0,i.jsxs)(a.Z,{children:["in_progress"===E&&(0,i.jsx)(a.Z.Item,{dot:(0,i.jsx)(r.Z,{}),children:"Building..."},"message-spin"),b.filter(e=>""!==e).reverse().map((e,t)=>"".concat(e).toLowerCase().indexOf("error")>-1?(0,i.jsx)(a.Z.Item,{className:"text-red-600",children:(0,u.ZP)("".concat(e))},"message-".concat(t)):(0,i.jsx)(a.Z.Item,{children:(0,u.ZP)("".concat(e))},"message-".concat(t)))]})]})}},25026:function(e,t,n){n.d(t,{o:function(){return s}});var i=n(11163),r=n(67294);let s=()=>{let e=(0,i.useRouter)(),t=e.asPath,n=new URLSearchParams(e.asPath.split("?")[1]),s=Object.fromEntries(n),[l,a]=(0,r.useState)(s),o=t=>{let n={...l};return t.forEach(e=>{delete n[e]}),a(n),e.push(e.pathname,{query:n}),l},c=()=>{let e=Object.keys(l);return o(e)};return(0,r.useEffect)(()=>{if(e.isReady){if(-1===t.indexOf("?")){c();return}a(s)}},[e.asPath,e.isReady]),[l,{setQuery:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={...l,...t};return a(n),e.push("".concat(e.pathname),{query:n}),n},deleteQuery:o,deleteAllQueryKeys:c}]}},91144:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(51855),r=n(25026),s=n(67294);let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,[t]=s.useState(()=>{try{var t,n;return null==window?void 0:null===(t=window.location)||void 0===t?void 0:null===(n=t.hostname)||void 0===n?void 0:n.split(".")[e]}catch(i){console.error(i.message);return}});return t}(),[{workspace:n}]=(0,r.o)(),l="app"===t||"localhost"===t||"diginext"===t?e.name:null!=n?n:t,{data:a}=(0,i.xh)(l);return a}},83202:function(e,t,n){n.d(t,{o:function(){return eq}});var i,r=n(85893),s=n(58720),l=n(92195),a=n(87743),o=n(5678),c=n(97183),u=n(11163),d=n(67294),h=n(44384),g=n(45669),x=n(84435),m=n(97937),v=n(50888),p=n(63606),f=n(79531);let j=e=>{let t;let{label:n,name:i,requiredMessage:s="This field is required.",defaultValue:l,value:a,status:c}=e,u=h.Z.useFormInstance(),[g,x]=(0,d.useState)(null!=a?a:l),j=(0,o.Nr)(g,500);(0,d.useEffect)(()=>{u.setFieldValue(i,a),x(a)},[a]),(0,d.useEffect)(()=>{j!==a&&u.submit()},[j]);let y=e=>{u.setFieldValue(i,e.currentTarget.value),x(e.currentTarget.value)};return c&&"error"===c[i]&&(t=(0,r.jsx)(m.Z,{})),c&&"loading"===c[i]&&(t=(0,r.jsx)(v.Z,{})),c&&"success"===c[i]&&(t=(0,r.jsx)(p.Z,{color:"green"})),(0,r.jsx)(h.Z.Item,{label:n,name:i,rules:[{required:!0,message:"Please input your ".concat(i)}],children:(0,r.jsx)(f.Z,{suffix:t,onChange:y})})};var y=n(25026),k=n(85265);let Z=(0,d.createContext)({}),_=()=>{let e=(0,d.useContext)(Z);return e};var b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,d.useState)({lv1:!1,lv2:!1}),[i,s]=(0,d.useState)(),[l,a]=(0,d.useState)(),o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lv1",t=arguments.length>1?arguments[1]:void 0;return void 0!==t?n(n=>{let i={...n};return i[e]=t,i}):n(t=>{let n={...t};return n[e]=!t[e],n})},c=e=>{e?o(e,!1):n({lv1:!1,lv2:!1})},u=()=>{n(e=>({...e,lv1:!1}))},h=()=>{n(e=>({...e,lv2:!1}))},g=(e,t)=>{switch(null==t?void 0:t.level){case 1:s(e),o("lv1",!0);break;case 2:a(e),o("lv2",!0)}};return(0,r.jsxs)(Z.Provider,{value:{drawerVisibility:t,toggleDrawer:o,showDrawer:g,closeDrawer:c},children:[e.children,(0,r.jsxs)(k.Z,{title:null==i?void 0:i.title,placement:"right",onClose:u,open:t.lv1,size:"large",children:[null==i?void 0:i.content,(0,r.jsx)(k.Z,{title:null==l?void 0:l.title,placement:"right",onClose:h,open:t.lv2,size:"large",children:null==l?void 0:l.content})]})]})},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=e,[n,i]=(0,g.aC)(),{drawerVisibility:s}=_(),[,{deleteQuery:l}]=(0,y.o)(),[a]=h.Z.useForm(),[o,c]=(0,d.useState)(),[{cluster_slug:u}]=(0,y.o)(),{data:m}=(0,x.pD)(u,{populate:"owner"}),[v,p]=(0,x.ve)({filter:{id:null==m?void 0:m._id}}),[f,k]=(0,x.CN)();console.log("cluster :>> ",m);let Z=void 0===m,b=async e=>{let t;console.log(Z?"[NEW]":"[EDIT]","Submit:",e);let n={...e};if(Z)t=await f(n);else{let i={};Object.entries(n).forEach(e=>{let[t,r]=e;m&&r!==m[t]?i[t]="loading":(delete i[t],delete n[t])}),c(i),t=await v(n)}console.log("result :>> ",t)},w=e=>{console.log("Failed:",e)};return(0,d.useEffect)(()=>{if(void 0===o)return;let e=Object.keys(o),t={};e.forEach(e=>{t[e]=p}),c(t)},[p]),(0,r.jsx)("div",{children:(0,r.jsxs)(h.Z,{layout:"vertical",form:a,onFinish:b,onFinishFailed:w,autoComplete:"off",children:[(0,r.jsx)(j,{label:"Cluster name",name:"name",value:null==m?void 0:m.name,status:o}),(0,r.jsx)(j,{label:"Short name",name:"shortName",value:null==m?void 0:m.shortName,status:o})]})})};let E=()=>{let e;let[{type:t}]=(0,y.o)();return"cluster"===t&&(e=(0,r.jsx)(w,{})),(0,r.jsx)("div",{children:e})};var S=n(53971),C=n(52545),N=n(45350),P=n(65184),A=n(13179),L=n(70125),R=n(40717),I=n(13520),B=n(139),T=n(26522),U=n(87547),F=n(55355),O=n(94149),D=n(42952),q=n(36907),z=n(87412),X=n(96486),M=n(41664),Q=n.n(M);let K=(0,d.createContext)({sidebarCollapsed:!1}),V=()=>{let e=(0,d.useContext)(K);return e};var Y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,d.useState)(!1),i=e=>void 0!==e?n(e):n(e=>!e);return(0,r.jsx)(K.Provider,{value:{sidebarCollapsed:t,toggleSidebar:i},children:e.children})};let H=[{key:"menu/",icon:(0,r.jsx)(S.Z,{}),label:"Dashboard"},{key:"menu/project",icon:(0,r.jsx)(C.Z,{}),label:"Projects"},{key:"menu/framework",icon:(0,r.jsx)(N.Z,{}),label:"Frameworks"},{key:"menu/git",icon:(0,r.jsx)(P.Z,{}),label:"Git Providers"},{key:"menu/infrastructure",icon:(0,r.jsx)(A.Z,{}),label:"Infrastructure",children:[{key:"menu/infrastructure/cloud-provider",icon:(0,r.jsx)(L.Z,{}),label:"Cloud Providers"},{key:"menu/infrastructure/cluster",icon:(0,r.jsx)(R.Z,{}),label:"K8S Clusters"},{key:"menu/infrastructure/database",icon:(0,r.jsx)(I.Z,{}),label:"Databases"},{key:"menu/infrastructure/registry",icon:(0,r.jsx)(B.Z,{}),label:"Container Registries"}]},{key:"menu/workspace",icon:(0,r.jsx)(T.Z,{}),label:"Workspace",children:[{key:"menu/workspace/users",icon:(0,r.jsx)(U.Z,{}),label:"Users"},{key:"menu/workspace/teams",icon:(0,r.jsx)(F.Z,{}),label:"Teams"},{key:"menu/workspace/roles",icon:(0,r.jsx)(O.Z,{}),label:"Roles"},{key:"menu/workspace/settings",icon:(0,r.jsx)(D.Z,{}),label:"Settings"}]}],W=()=>{let e=(0,u.useRouter)(),{sidebarCollapsed:t,toggleSidebar:n}=V(),{isDarkMode:i}=(0,o.vs)(),s="menu/".concat((0,X.trimStart)(e.pathname,"/").split("/")[0]),l="menu".concat((0,X.trimEnd)(e.pathname,"/")),a=t=>{let n=(0,X.trimStart)(t.key,"menu");e.push(n)};return(0,r.jsxs)(z.ZP,{theme:"light",collapsible:!0,collapsed:t,onCollapse:e=>n&&n(e),style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0},children:[t?(0,r.jsx)("div",{className:"mx-auto my-5 w-[32px]",children:(0,r.jsx)(Q(),{href:"/",children:(0,r.jsx)("img",{src:i?"".concat(e.basePath,"/assets/images/diginext-icon-white.svg"):"".concat(e.basePath,"/assets/images/diginext-icon-black.svg"),alt:"Diginext Logo"})})}):(0,r.jsx)("div",{className:"mx-auto my-5 w-36",children:(0,r.jsx)(Q(),{href:"/",children:(0,r.jsx)("img",{src:i?"".concat(e.basePath,"/assets/images/diginext_logo_white.svg"):"".concat(e.basePath,"/assets/images/diginext_logo.svg"),alt:"Diginext Logo"})})}),(0,r.jsx)(q.Z,{mode:"inline",inlineCollapsed:t,defaultOpenKeys:[s],defaultSelectedKeys:[s,l],items:H,onSelect:a})]})};var G=n(51369);let J=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.jsxs)("div",{children:[e.children,(0,r.jsxs)("div",{className:"border-t border-gray-300 py-8 text-center text-xs",children:["\xa9 Copyright ",new Date().getFullYear()," ",G.XL.title,". Powered by ",(0,r.jsx)("a",{href:"https://wearetopgroup.com",children:"TOP GROUP"}),"."]})]})};var $=n(19944),ee=n(84477),et=n(68795),en=n(25035),ei=n(80882),er=n(26713),es=n(71577),el=n(55241),ea=n(98293);let{Header:eo}=c.Z,ec=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onSidebarChange:t}=e,{isDarkMode:n,toggle:i}=(0,o.vs)(),[s]=(0,g.aC)(),{token:{colorBgContainer:a}}=l.Z.useToken(),{sidebarCollapsed:c,toggleSidebar:u}=V();return(0,d.useEffect)(()=>t&&t(c),[c]),(0,r.jsx)(eo,{className:"w-full",style:{position:"sticky",top:0,paddingInline:24,lineHeight:"48px",height:48,zIndex:100,background:a},children:(0,r.jsxs)("div",{className:"flex ",children:[(0,r.jsx)("div",{className:"grow",children:d.createElement(c?$.Z:ee.Z,{className:"trigger",onClick:()=>u&&u()})}),(0,r.jsxs)(er.Z,{size:4,children:[(0,r.jsx)(es.Z,{type:"text",icon:(0,r.jsx)(et.Z,{})}),(0,r.jsx)(es.Z,{type:"text",icon:(0,r.jsx)(en.Z,{})}),(0,r.jsx)(es.Z,{type:"text",style:{fontSize:18,verticalAlign:"middle",paddingTop:0},onClick:i,icon:n?(0,r.jsx)("i",{className:"ri-sun-line inline-block"}):(0,r.jsx)("i",{className:"ri-moon-line inline-block"})}),(0,r.jsx)(el.Z,{placement:"bottomRight",trigger:"click",content:(0,r.jsxs)(er.Z,{direction:"vertical",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"mb-0",children:(0,r.jsx)("strong",{children:null==s?void 0:s.name})}),(0,r.jsx)("p",{className:"mb-0",children:null==s?void 0:s.email})]}),(0,r.jsxs)(er.Z.Compact,{direction:"vertical",className:"w-full",children:[(0,r.jsx)(es.Z,{children:"Profile"}),(0,r.jsx)(es.Z,{href:"/logout",children:"Sign out"})]})]}),children:(0,r.jsxs)("div",{className:"cursor-pointer align-middle",children:[(0,r.jsx)(ea.C,{style:{lineHeight:"20px"},icon:(0,r.jsx)(U.Z,{style:{verticalAlign:"middle"}}),src:null==s?void 0:s.image,size:24}),(0,r.jsx)("span",{className:"ml-2 inline-block",children:null==s?void 0:s.name}),(0,r.jsx)(ei.Z,{className:"ml-2"})]})})]})]})})};var eu=n(45605),ed=n(18429),eh=n(8751),eg=n(37993),ex=n(99611),em=n(67841),ev=n(51904),ep=n(83062),ef=n(21889),ej=n(27484),ey=n.n(ej),ek=n(12780),eZ=n(14223);let e_=e=>(0,eZ.wz)(["releases","list"],"/api/v1/release",e),eb=e=>(0,eZ.yt)(["releases","rollout"],"/api/v1/release/rollout",e),ew=e=>(0,eZ.FF)(["releases","create"],"/api/v1/release/from-build",e),eE=e=>(0,eZ.yt)(["releases","preview"],"/api/v1/release/preview",e);var eS=n(77418);let eC=n(56176),eN=n(84110);ey().extend(eN),ey().extend(eC);let{useApp:eP}=a.Z,eA=[{title:"Name",width:70,dataIndex:"name",key:"name",filterSearch:!0,filters:[{text:"goon",value:"goon"}],onFilter:(e,t)=>t.name&&t.name.indexOf(e.toString())>-1||!0,render:(e,t)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{children:(0,r.jsx)(Q(),{href:{pathname:"/build/[...slugs]",query:{slugs:[t.slug]}},children:(0,r.jsx)("strong",{children:e})})}),(0,r.jsxs)("p",{children:["Created ",(0,r.jsx)(eS.q,{date:t.createdAt})]})]})},{title:"Created by",dataIndex:"owner",key:"owner",width:40,filterSearch:!0,filters:[{text:"goon",value:"goon"}],onFilter:(e,t)=>t.owner&&(t.owner.slug||"").indexOf(e.toString())>-1||!0,render:e=>(0,r.jsx)(r.Fragment,{children:null==e?void 0:e.name})},{title:"Status",dataIndex:"status",key:"status",width:30,filters:[{text:"live",value:"live"}],render:e=>{let t="warning",n=(0,r.jsx)(eu.Z,{});switch(e){case"building":t="processing",n=(0,r.jsx)(v.Z,{className:"align-middle"});break;case"failed":t="error",n=(0,r.jsx)(ed.Z,{className:"align-middle"});break;case"success":t="success",n=(0,r.jsx)(eh.Z,{className:"align-middle"});break;default:t="default",n=(0,r.jsx)(eu.Z,{})}return(0,r.jsx)(ev.Z,{color:t,icon:n,children:e})}},{title:"Action",key:"action",width:30,dataIndex:"action"}],eL=()=>{(0,u.useRouter)();let e=eP(),[t,{setQuery:n}]=(0,y.o)(),{project:i,app:s,env:l}=t,a={};i&&(a.projectSlug=i),s&&(a.appSlug=s),l&&(a.env=l);let[o,c]=(0,d.useState)(1),{data:h}=(0,ek.BY)({populate:"owner",pagination:{page:o,size:100},filter:a}),{list:g,pagination:x}=h||{},{total_items:m}=x||{},v=e=>{n({lv2:"build_logs",build_slug:e})},[p]=ew(),f=async t=>{if((0,X.isEmpty)(t)){e.notification.error({message:"Failed to release the build.",description:"Build not found: ".concat(t),placement:"top"});return}try{let n=await p({build:t});e.notification.success({message:"Congrats, the release has been created successfully!",description:(0,r.jsxs)(r.Fragment,{children:["You can now preview it on ",(0,r.jsx)("a",{href:"https://".concat(null==n?void 0:n.prereleaseUrl),children:"PRE-RELEASE"})," endpoint."]}),placement:"top"})}catch(i){console.error("Could not process releasing this build:",i),e.notification.error({message:"Failed to roll out.",description:"Could not process releasing this build: ".concat(i),placement:"top"})}},j=null==g?void 0:g.map(e=>({id:e._id,...e,action:(0,r.jsxs)(er.Z.Compact,{children:[(0,r.jsx)(ep.Z,{title:"View log history",children:(0,r.jsx)(es.Z,{icon:(0,r.jsx)(eg.Z,{}),onClick:()=>v(e.slug)})}),(0,r.jsx)(ep.Z,{title:"Go to image link",children:(0,r.jsx)(es.Z,{icon:(0,r.jsx)(ex.Z,{}),href:"https://".concat(e.image),target:"_blank"})}),"prod"===e.env&&(0,r.jsx)(ep.Z,{title:"Release this build",children:(0,r.jsx)(es.Z,{icon:(0,r.jsx)(em.Z,{}),onClick:()=>{var t;return f(null===(t=e._id)||void 0===t?void 0:t.toString())}})})]})})),k=e=>{let{current:t}=e;c(null!=t?t:1)};return(0,r.jsx)("div",{children:(0,r.jsx)(ef.Z,{columns:eA,dataSource:j,scroll:{x:600},sticky:{offsetHeader:0},pagination:{current:o,pageSize:100,total:m},onChange:k})})};var eR=n(46003);let eI=n(56176),eB=n(84110);ey().extend(eB),ey().extend(eI);let{useApp:eT}=a.Z,eU=[{title:"Name",width:70,dataIndex:"name",key:"name",filterSearch:!0,filters:[{text:"goon",value:"goon"}],onFilter:(e,t)=>t.name&&t.name.indexOf(e.toString())>-1||!0,render:(e,t)=>{var n;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{children:(0,r.jsx)("strong",{children:e})}),(0,r.jsxs)("p",{children:["Author: ",null!==(i=null===(n=t.owner)||void 0===n?void 0:n.name)&&void 0!==i?i:"-",(0,r.jsx)("br",{}),"Created ",(0,r.jsx)(eS.q,{date:t.createdAt})]})]})}},{title:"Build status",dataIndex:"buildStatus",key:"buildStatus",width:30,filters:[{text:"start",value:"start"},{text:"failed",value:"failed"},{text:"success",value:"success"},{text:"building",value:"building"}],render:e=>{let t="warning",n=(0,r.jsx)(eu.Z,{});switch(e){case"building":t="processing",n=(0,r.jsx)(v.Z,{className:"align-middle"});break;case"failed":t="error",n=(0,r.jsx)(ed.Z,{className:"align-middle"});break;case"success":t="success",n=(0,r.jsx)(eh.Z,{className:"align-middle"});break;default:t="default",n=(0,r.jsx)(eu.Z,{})}return(0,r.jsx)(ev.Z,{color:t,icon:n,children:e})}},{title:"Active",dataIndex:"active",key:"active",width:20,filters:[{text:"active",value:!0}],onFilter:(e,t)=>t.active===e,render:e=>!0===e?(0,r.jsx)(ev.Z,{color:"blue",icon:(0,r.jsx)(eh.Z,{}),children:"active"}):"-"},{title:"Action",key:"action",width:30,dataIndex:"action",render:e=>e}],eF=()=>{(0,u.useRouter)();let e=eT(),[t]=(0,y.o)(),{project:n,app:i,offsetHeader:s=0,env:l="prod"}=t,a={};n&&(a.projectSlug=n),i&&(a.appSlug=i),l&&(a.env=l);let[o,c]=(0,d.useState)(1),{data:h}=e_({populate:"owner",pagination:{page:o,size:100},filter:a}),{list:g=[],pagination:x}=h||{},{total_items:m}=x||{},[p,f]=eb();console.log("rolloutApiStatus :>> ",f);let[j,k]=(0,d.useState)(""),[Z]=eE(),_=async t=>{if((0,X.isEmpty)(t)){e.notification.error({message:"Failed to roll out.",description:"Release not found: ".concat(t),placement:"top"});return}k(t);try{let n=await p({id:t});e.notification.success({message:"Congrats, the release has been rolled out successfully!",description:(0,r.jsxs)(r.Fragment,{children:["Your website is ready to access on PRODUCTION environment:"," ",(0,r.jsx)("a",{href:"https://".concat(null==n?void 0:n.productionUrl),target:"_blank",rel:"noreferrer",children:null==n?void 0:n.productionUrl})]}),placement:"top"})}catch(i){console.error("Could not process rolling out this release:",i),e.notification.error({message:"Failed to roll out.",description:"Could not process rolling out this release: ".concat(i),placement:"top"})}k("")},b=async t=>{if((0,X.isEmpty)(t)){e.notification.error({message:"Failed to preview.",description:"Release not found: ".concat(t),placement:"top"});return}try{let n=await Z({id:t});e.notification.success({message:"Congrats!",description:(0,r.jsxs)(r.Fragment,{children:["The PRE-RELEASE environment has been setup successfully at:"," ",(0,r.jsx)("a",{href:"https://".concat(null==n?void 0:n.prereleaseUrl),target:"_blank",rel:"noreferrer",children:null==n?void 0:n.prereleaseUrl})]}),placement:"top"})}catch(i){e.notification.error({message:"Failed to start preview.",description:"Could not set up the pre-release environment of this release: ".concat(i),placement:"top"})}},w=g.map(e=>({...e,id:e._id,state:""!==j?f:!0===e.active?"success":"none",action:(0,r.jsxs)(er.Z.Compact,{children:[(0,r.jsx)(ep.Z,{title:"Roll out",children:(0,r.jsx)(es.Z,{icon:""!==j&&"loading"===f?(0,r.jsx)(v.Z,{}):(0,r.jsx)(em.Z,{}),onClick:()=>_(e._id)})}),(0,r.jsx)(ep.Z,{title:"Preview",children:(0,r.jsx)(es.Z,{icon:(0,r.jsx)(ex.Z,{}),onClick:()=>b(e._id),target:"_blank"})})]})}));console.log({displayedReleases:w});let E=e=>{let{current:t}=e;c(null!=t?t:1)};return(0,r.jsx)("div",{children:(0,r.jsx)(ef.Z,{columns:eU,dataSource:w,scroll:{x:600},sticky:{offsetHeader:s},pagination:{current:o,pageSize:100,total:m},onChange:E})})},eO=e=>{let{useSidebar:t}=e;(0,u.useRouter)();let{sidebarCollapsed:n}=V(),i="auto";t&&(i=n?80:200);let s=_(),{drawerVisibility:a,showDrawer:o,closeDrawer:h}=s,[g,{setQuery:x,deleteQuery:m,deleteAllQueryKeys:v}]=(0,y.o)(),{lv1:p,lv2:f,type:j,slug:k,project:Z,app:b,env:w}=g,{token:{colorText:S}}=l.Z.useToken(),C=()=>{o&&o({title:"Builds",content:(0,r.jsx)(eL,{})},{level:1})},N=()=>{o&&o({title:"Releases",content:(0,r.jsx)(eF,{})},{level:1})},P=()=>{o&&o({title:"Build Logs",content:(0,r.jsx)(eR.O,{})},{level:2})},A=()=>{o&&o({title:"Edit",content:(0,r.jsx)(E,{})},{level:1})};return(0,d.useEffect)(()=>{switch(p){case"build":C();break;case"release":N();break;case"edit":A();break;default:h&&h("lv1")}"build_logs"===f?P():h&&h("lv2")},[p,f,Z,b,w]),(0,d.useEffect)(()=>{(null==a?void 0:a.lv1)===!1&&m(["lv1","project","app","release","type","cluster_slug"])},[null==a?void 0:a.lv1]),(0,d.useEffect)(()=>{(null==a?void 0:a.lv2)===!1&&m(["lv2","build_slug"])},[null==a?void 0:a.lv2]),(0,r.jsxs)(c.Z,{hasSider:!0,children:[e.meta,t&&(0,r.jsx)(W,{}),(0,r.jsxs)(c.Z,{className:"min-h-screen transition-all",style:{marginLeft:i},children:[t&&(0,r.jsx)(ec,{}),(0,r.jsx)("div",{className:"grow px-2",children:e.children}),(0,r.jsx)(J,{})]})]})};function eD(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{components:t=[],children:n,...i}=e;return(0,r.jsx)(r.Fragment,{children:t.reduceRight((t,n)=>(0,d.createElement)(n,{...i,key:e.key},t),n)})}let eq=e=>{let{isDarkMode:t}=(0,o.vs)(),{useSidebar:n=!0}=e;return(0,r.jsx)(s.ZP,{theme:{hashed:!1,algorithm:t?l.Z.darkAlgorithm:l.Z.defaultAlgorithm},children:(0,r.jsx)(eD,{components:[Y,b],children:(0,r.jsx)(a.Z,{children:(0,r.jsx)(eO,{meta:e.meta,useSidebar:n,children:e.children})})})})}},51369:function(e,t,n){n.d(t,{De:function(){return o},XL:function(){return a},r8:function(){return c}});var i=n(4793),r=n(96486),s=n(83454);let l={DEVELOPMENT:"development",STAGING:"staging",CANARY:"canary",PRODUCTION:"production"},a={site_name:"Diginext Admin",title:"Diginext Admin",description:"Welcome to an Admin Panel of Diginext.",locale:"en",tableConfig:{defaultPageSize:50}};class o{static get ENV(){return this.grab("NODE_ENV","development").toUpperCase()}static get NEXT_PUBLIC_BASE_PATH(){return""}static getBasePath(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",{NEXT_PUBLIC_BASE_PATH:t}=this;return(""===t?t:"/".concat(t))+e}static path(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.getBasePath(e)}static get NEXT_PUBLIC_ENV(){return"production"}static get NEXT_PUBLIC_API_BASE_URL(){return(0,r.trimEnd)("https://api.diginext.site","/")||"/"}static get NEXT_PUBLIC_DOMAIN(){return"diginext.site"}static get NEXT_PUBLIC_BASE_URL(){return(0,r.trimEnd)("https://app.diginext.site","/")||"/"}static get DISABLE_INPECT_MEMORY(){return(0,i.AM)(this.grab("DISABLE_INPECT_MEMORY"))}static get SECONDS_INPECT_MEMORY(){return(0,i.Hq)(this.grab("SECONDS_INPECT_MEMORY"))}static get CORS_WHITELIST(){return s.env.CORS_WHITELIST?s.env.CORS_WHITELIST.split(";"):["localhost","192.168","127.0","digitop.vn","diginext.site","diginext.vn"]}}o.grab=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={...s.env};return null!==(t=i[e])&&void 0!==t?t:n};let c=()=>o.NEXT_PUBLIC_ENV===l.DEVELOPMENT}}]);