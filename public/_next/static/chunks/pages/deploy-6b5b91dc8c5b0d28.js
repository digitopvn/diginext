(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3523],{83103:function(e,l,t){"use strict";t.d(l,{Z:function(){return n}});var i=t(30001),a=t(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},o=t(94590),r=function(e,l){return a.createElement(o.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:l,icon:s}))};r.displayName="ArrowRightOutlined";var n=a.forwardRef(r)},18287:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deploy",function(){return t(14678)}])},7571:function(e,l,t){"use strict";t.d(l,{BT:function(){return s},E_:function(){return o},Zz:function(){return a}});var i=t(19005);let a=e=>(0,i.wz)(["projects","list"],"/api/v1/project",e),s=e=>(0,i.wz)(["projects","list"],"/api/v1/project/with-apps",e),o=()=>(0,i.TV)(["projects","delete"],"/api/v1/project")},61160:function(e,l,t){"use strict";var i=t(11527),a=t(47164),s=t(50959),o=t(89335);let r=e=>{let l=(0,a.useRouter)(),{isDarkMode:t}=(0,o.vs)(),[r,n]=(0,s.useState)("".concat(l.basePath,"/assets/images/diginext_logo_white.svg"));return(0,s.useEffect)(()=>{n(t?"".concat(l.basePath,"/assets/images/diginext_logo_white.svg"):"".concat(l.basePath,"/assets/images/diginext_logo.svg"))},[t]),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"mx-auto my-5 w-64 text-center ".concat(e.className),children:(0,i.jsx)("img",{src:r,alt:"Diginext Logo"})}),e.useTagline&&(0,i.jsx)("div",{className:"mb-6",children:"Build faster. Deploy easier. More flexible."})]})};l.Z=r},14678:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return z}});var i=t(11527),a=t(47725),s=t.n(a),o=t(2154),r=t(70804),n=t(61160),c=t(32105),u=t(83103),d=t(42423),p=t(75616),v=t(50002),h=t(476),m=t(46457),g=t(3748),x=t(86663),f=t(80042),j=t(58699),w=t(32699),b=t(50959),y=t(82586),Z=t(31924),S=t(73621),N=t(61371),P=t(29956),C=t(7571),_=t(79402),L=t(89992),E=t(49309);let R=e=>{var l,t,a,s,o,r,n;let{className:R=""}=e,{token:{colorBgContainer:T}}=p.Z.useToken(),[B]=v.Z.useForm(),[V,{setQuery:z}]=(0,E.o)(),{project:D,app:I,env:O,registry:k,cluster:q,build:F,branch:H,port:M}=V,[U,A]=(0,b.useState)(),[G,X]=(0,b.useState)(),[W,Y]=(0,b.useState)(),[J,K]=(0,b.useState)(),[Q,$]=(0,b.useState)(),{data:{list:ee=[]}={},status:el}=(0,C.BT)({populate:"owner",pagination:{page:1,size:100}}),{data:{list:et}={}}=(0,y.VD)(),{data:{list:ei}={}}=(0,_.fy)(),{data:{list:ea}={}}=(0,S.x7)(),{data:{list:es}={}}=(0,Z.BY)({filter:{appSlug:null==U?void 0:U.slug}}),[eo,er]=(0,N._q)(),en=(0,L.t1)((null==U?void 0:null===(l=U.git)||void 0===l?void 0:l.repoSSH)||""),{data:{list:ec}={}}=(0,P.Td)(en.repoSlug||"",{enabled:void 0!==en.repoSlug&&void 0!==(null==U?void 0:U.gitProvider),filter:{_id:null==U?void 0:U.gitProvider}}),eu=(0,w.flatMap)(ee,"apps"),ed=async e=>{console.log("Submit:",e),eo({appSlug:e.app,gitBranch:e.gitBranch,deployParams:{env:e.env,cluster:e.cluster,registry:e.registry}}).then(e=>{var l,t;console.log("res.data?.logURL :>> ",null===(l=e.data)||void 0===l?void 0:l.logURL),$(null===(t=e.data)||void 0===t?void 0:t.logURL)})},ep=e=>{console.log("Failed:",e)};return(0,i.jsxs)(h.Z,{bordered:!1,title:(0,i.jsx)(m.Z.Title,{level:4,className:"!mb-0 text-center",children:"success"===er?"A deployment is being processed!":"loading"===er?"Processing...":"Deploy your app"}),children:["loading"===er&&(0,i.jsx)(c.Z,{}),"success"!==er?(0,i.jsxs)(v.Z,{className:["h-full","overflow-x-hidden",R].join(" "),layout:"vertical",form:B,onFinish:ed,onFinishFailed:ep,autoComplete:"off",children:[(0,i.jsx)(v.Z.Item,{name:"app",rules:[{required:!0,message:"Please select app."}],className:"mb-2",initialValue:I,children:(0,i.jsx)(g.Z,{placeholder:"Select app",onSelect(e){let l=eu.find(l=>l.slug===e);A(l)},showSearch:!0,filterOption:(e,l)=>(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase()),options:null==ee?void 0:ee.map(e=>{var l;return{label:e.name,options:null===(l=e.apps)||void 0===l?void 0:l.map(e=>({label:e.name,value:e.slug}))}})})}),(0,i.jsx)(v.Z.Item,{name:"env",label:"Deploy environment",rules:[{required:!0,message:"Please select deploy environment."}],className:"mb-2",initialValue:O,children:(0,i.jsxs)(x.ZP.Group,{onChange(e){K(e.target.value),Y(((null==U?void 0:U.deployEnvironment)||{})[e.target.value])},children:[(0,i.jsx)(x.ZP,{value:"dev",children:"dev"}),(0,i.jsx)(x.ZP,{value:"prod",children:"prod"}),(0,i.jsx)(x.ZP,{value:"other",children:"other"===J?(0,i.jsx)(f.Z,{style:{width:100,marginLeft:10},onChange(e){Y(((null==U?void 0:U.deployEnvironment)||{})[e.target.value])}}):(0,i.jsx)(i.Fragment,{children:"+ other"})})]})}),(0,i.jsx)(v.Z.Item,{name:"registry",rules:[{required:!0,message:"Please select container registry."}],className:"mb-2",initialValue:(null==W?void 0:W.registry)||k||(null===(t=(ei||[])[0])||void 0===t?void 0:t.slug),children:(0,i.jsx)(g.Z,{placeholder:"Container registry",showSearch:!0,filterOption:(e,l)=>(null!==(s=null==l?void 0:l.label)&&void 0!==s?s:"").toLowerCase().includes(e.toLowerCase()),options:null==ei?void 0:ei.map(e=>({label:e.name,value:e.slug})),onSelect:e=>console.log("Select container registry > value :>> ",e)})}),(0,i.jsx)(v.Z.Item,{name:"cluster",rules:[{required:!0,message:"Please select cluster."}],className:"mb-2",initialValue:q,children:(0,i.jsx)(g.Z,{placeholder:"Cluster",showSearch:!0,filterOption:(e,l)=>(null!==(o=null==l?void 0:l.label)&&void 0!==o?o:"").toLowerCase().includes(e.toLowerCase()),options:null==ea?void 0:ea.map(e=>({label:e.name,value:e.shortName}))})}),(0,i.jsx)(v.Z.Item,{name:"build",className:"mb-2",children:(0,i.jsx)(g.Z,{placeholder:"Start new build",showSearch:!0,filterOption:(e,l)=>(null!==(r=null==l?void 0:l.label)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase()),options:[{label:"Start new build",value:"new"},...(null==es?void 0:es.map(e=>({label:e.name,value:e.slug})))||[]],onSelect:e=>X(null==es?void 0:es.find(l=>l.slug===e))})}),void 0===G?(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsx)(v.Z.Item,{name:"gitBranch",rules:[{required:!0,message:"Please git branch."}],initialValue:"main",children:(0,i.jsx)(g.Z,{placeholder:"Git branch",showSearch:!0,filterOption:(e,l)=>(null!==(n=null==l?void 0:l.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase()),options:null==ec?void 0:ec.map(e=>({label:e.name,value:e.name}))})}),(0,i.jsx)(v.Z.Item,{name:"port",rules:[{required:!0,message:"Please enter exposed port."}],initialValue:(null==W?void 0:W.port)||M||"3000",children:(0,i.jsx)(f.Z,{placeholder:"Port",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})})]}):(0,i.jsx)(i.Fragment,{}),(0,i.jsx)(v.Z.Item,{style:{marginBottom:0},className:"text-center",children:(0,i.jsx)(j.ZP,{type:"primary",htmlType:"submit",icon:(0,i.jsx)(u.Z,{}),size:"large",shape:"round",children:"Deploy Now"})})]}):(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)(j.ZP,{href:Q,icon:(0,i.jsx)(d.Z,{}),size:"large",shape:"round",children:"View build logs"})})]})};var T=t(26697),B=t(24810);let V=()=>(0,i.jsx)(o.Wk,{children:(0,i.jsx)(T.o,{useSidebar:!1,meta:(0,i.jsx)(B.h,{title:"Deploy Now",description:"Deploy your application to target environment."}),children:(0,i.jsxs)(r.Z,{className:"max-w-md ",children:[(0,i.jsx)(s(),{href:"/",children:(0,i.jsx)(n.Z,{})}),(0,i.jsx)(R,{})]})})});var z=V},89992:function(e,l,t){"use strict";function i(e){var l,t,i,a;let s,o,r,n;if(!e)return{};try{s=null===(l=e.split(":")[1])||void 0===l?void 0:l.split("/")[0]}catch(c){throw Error("Repository SSH (".concat(e,") is invalid"))}try{o=null===(t=null===(i=e.split(":")[1])||void 0===i?void 0:i.split("/")[1])||void 0===t?void 0:t.split(".")[0]}catch(u){throw Error("Repository SSH (".concat(e,") is invalid"))}try{r=null===(a=e.split(":")[0])||void 0===a?void 0:a.split("@")[1]}catch(d){throw Error("Repository SSH (".concat(e,") is invalid"))}try{n=null==r?void 0:r.split(".")[0]}catch(p){throw Error("Repository SSH (".concat(e,") is invalid"))}let v="".concat(s,"/").concat(o);return{namespace:s,repoSlug:o,fullSlug:v,gitDomain:r,gitProvider:n}}t.d(l,{t1:function(){return i}}),t(32699)}},function(e){e.O(0,[8201,2967,1187,7655,9774,2888,179],function(){return e(e.s=18287)}),_N_E=e.O()}]);