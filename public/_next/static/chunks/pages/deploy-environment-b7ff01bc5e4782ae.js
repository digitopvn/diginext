(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5120],{28245:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deploy-environment",function(){return t(27372)}])},27372:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return U}});var l,a=t(11527),d=t(18820);t(85664);var i=t(80402),r=t(67576),o=t(59701),s=t(50103),c=t(30388),p=t(44177),u=t(64686);t(71370),t(31494);var v=t(48880),m=t(74637),h=t.n(m),x=t(79789),g=t.n(x),f=t(76806),j=t(50959),y=t(43008),k=t(29834),E=t(92961),b=t(70297),w=t(11942),Z=t(14149),_=t(32352),I=t(80244),C=t(49523),N=t(81035),S=t(45581),z=t(75112),P=t(2513);t(17349);var F=t(81243);t(18405);let A=t(64814),D=t(54498);h().extend(D),h().extend(A);let O=null!==(l=P.XL.tableConfig.defaultPageSize)&&void 0!==l?l:20,L=()=>{var e,n;let t=(0,f.useRouter)(),[l,{setQuery:d}]=(0,N.o)(),{responsive:m}=(0,S.Jl)(),{modal:x}=(0,z.f9)(),[P,A]=(0,j.useState)(l.page?parseInt(l.page,10):1);(0,s.NL)();let{data:D,status:L,refetch:R}=(0,y.VD)({populate:"owner,project",pagination:{page:P,size:O}}),{list:M,pagination:T}=D||{},{total_pages:U,total_items:V}=T||{},W=null==M?void 0:M.flatMap(e=>Object.entries(e.deployEnvironment||{}).map(n=>{let[t,l]=n;return{name:l.deploymentName,deployEnvironment:t,app:{id:e.id,name:e.name,slug:e.slug},project:e.project,...l}}));console.log({displayedDeployEnvironments:W});let{data:X,status:q}=(0,E.x7)({pagination:{page:P,size:50}}),{list:B}=X||{},K=[{title:"Deployment",width:30,dataIndex:"name",key:"name",fixed:(null==m?void 0:m.md)?"left":void 0,filterSearch:!0,render(e,n){var t,l;return(0,a.jsx)(g(),{href:"?lv1=deploy_environment&project=".concat(null===(t=n.project)||void 0===t?void 0:t.slug,"&app=").concat(null===(l=n.app)||void 0===l?void 0:l.slug,"&env=").concat(n.deployEnvironment),children:e})}},{title:"ENV",width:15,dataIndex:"deployEnvironment",key:"deployEnvironment",render:e=>(0,a.jsx)(p.Z,{color:"prod"===e?"success":"default",children:e}),filters:(0,C.Y)((null==W?void 0:W.map(e=>({text:e.deployEnvironment,value:e.deployEnvironment})))||[]).filter((e,n,t)=>n===t.findIndex(n=>n.value===e.value)),onFilter:(e,n)=>n.deployEnvironment===e},{title:"Project",width:30,dataIndex:"project",key:"project",render:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:e.name})," ",(0,a.jsx)(p.Z,{children:e.slug})]}),filters:(0,C.Y)(((null==W?void 0:W.map(t=>{var l,a;return{text:null!==(e=null===(l=t.project)||void 0===l?void 0:l.name)&&void 0!==e?e:"",value:null!==(n=null===(a=t.project)||void 0===a?void 0:a.slug)&&void 0!==n?n:""}}))||[]).filter(e=>""!==e.text&&""!==e.value)).filter((e,n,t)=>n===t.findIndex(n=>n.value===e.value)),onFilter(e,n){var t;return(null===(t=n.project)||void 0===t?void 0:t.slug)===e}},{title:"App",width:30,dataIndex:"app",key:"app",render:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:e.name})," ",(0,a.jsx)(p.Z,{children:e.slug})]})},{title:"Cluster",width:30,dataIndex:"cluster",key:"cluster",render:e=>(0,a.jsx)(u.ZP,{type:"link",style:{padding:0},children:e})},{title:"Size",dataIndex:"size",width:15,key:"size",render:e=>(0,a.jsx)(p.Z,{color:"none"===e?"default":"success",children:e})},{title:"Replicas",dataIndex:"replicas",key:"replicas",width:15},{title:"Last updated by",dataIndex:"lastUpdatedBy",key:"lastUpdatedBy",width:25,filterSearch:!0},{title:"Last updated",dataIndex:"updatedAt",key:"updatedAt",width:20,render:e=>(0,a.jsx)(Z.q,{date:e}),sorter:(e,n)=>h()(e.updatedAt).diff(h()(n.updatedAt))}],[Y,G]=(0,w.E_)(),[H,J]=(0,y._M)(),[Q,$]=(0,y.rg)(),[ee,en]=(0,y.WK)(),[et,el]=(0,y.md)(),[ea,ed]=(0,k.rA)(),[ei,er]=(0,k.fg)(),[eo,es]=(0,b.GD)(),[ec,ep]=(0,y.yq)(),[eu,ev]=(0,y.wt)(),[em,eh]=(0,y.kK)(),ex=()=>{let e=null==x?void 0:x.info({className:"!p-0",style:{padding:0},bodyStyle:{padding:0},icon:null,content:(0,a.jsx)(F.Z,{onClose:()=>null==e?void 0:e.destroy()}),footer:null,closable:!0,maskClosable:!0,onOk(){}})};(0,j.useEffect)(()=>{if(!t.isReady)return;let e=l.page?parseInt(l.page.toString(),10):1;A(e)},[l.page]);let eg=e=>{console.log("Table changed!");let{current:n}=e;d({page:null!=n?n:1})},ef=(0,j.useRef)(null),ej=(0,c.Z)(ef);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{commands:null==M?void 0:M.map(e=>({label:"".concat(e.name," (").concat(e.slug,")"),value:e,children:Object.keys(e.deployEnvironment||{}).map(n=>({value:e,label:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{children:e.slug}),"≫",(0,a.jsx)(p.Z,{children:n})]}),children:Object.keys(e.deployEnvironment||{}).map(n=>({label:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{}),"Deploy environment ≫ ".concat(n.toUpperCase())]}),value:(e.deployEnvironment||{})[n],onSelect:t=>d({lv1:"deploy_environment",project:e.slug,app:e.slug,env:n})}))}))}))}),(0,a.jsx)(_.V,{title:"Deploy environments",breadcrumbs:[{name:"Workspace"}],actions:[(0,a.jsx)(u.ZP,{icon:(0,a.jsx)(r.Z,{className:"align-middle"}),href:"/import",children:"Import"},"import-btn"),(0,a.jsx)(u.ZP,{icon:(0,a.jsx)(o.Z,{className:"align-middle"}),onClick:()=>ex(),children:"Create app"},"create-app-btn")]}),(0,a.jsx)("div",{className:"h-full flex-auto overflow-hidden",ref:ef,children:(0,a.jsx)(v.Z,{size:"small",loading:"loading"===L,columns:K,dataSource:W,scroll:{x:(null==m?void 0:m.md)?1600:1200,y:void 0!==(null==ej?void 0:ej.height)?ej.height-120:void 0},sticky:{offsetHeader:0},pagination:{showSizeChanger:!0,current:P,defaultPageSize:O,total:V,position:["bottomCenter"]},onChange:eg})})]})};var R=t(64060),M=t(10769);let T=()=>(0,a.jsx)(d.Wk,{children:(0,a.jsx)(R.o,{meta:(0,a.jsx)(M.h,{title:"Deploy Environment",description:"Manage deploy environments across clusters"}),children:(0,a.jsx)(L,{})})});var U=T}},function(e){e.O(0,[8201,8564,2967,1003,1203,9198,299,4825,9774,2888,179],function(){return e(e.s=28245)}),_N_E=e.O()}]);