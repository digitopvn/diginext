(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5120],{12117:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return deploy_environment}});var r,o=t(22598);t(50029);var i=t(59499),l=t(16835);t(87794),t(76971);var a=t(13179),u=t(57546),d=t(51042),c=t(85945),s=t(84213),p=t(66309),v=t(73318);t(26855),t(71471);var f=t(44973),m=t(27484),y=t.n(m),g=t(41664),x=t.n(g),h=t(11163),j=t(67294),b=t(34187),w=t(23907),Z=t(47859),O=t(4400),k=t(61771),E=t(61123),_=t(90447),P=t(21084),I=t(20100),N=t(91710),S=t(56832),C=t(3669),D=t(55240),A=t(55611);t(59322);var F=t(73455);t(53072);var z=t(85893);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var L=t(56176),M=t(84110);y().extend(M),y().extend(L);var K=null!==(r=A.XL.tableConfig.defaultPageSize)&&void 0!==r?r:20,DeployEnvironmentList=function(){var e=(0,h.useRouter)(),n=(0,S.o)(),t=(0,l.Z)(n,2),r=t[0],o=t[1].setQuery,m=(0,C.Jl)().responsive,g=(0,D.f9)().modal,A=(0,j.useState)(r.page?parseInt(r.page,10):1),L=A[0],M=A[1];(0,c.NL)();var R=(0,b.VD)({populate:"owner,project",pagination:{page:L,size:K}}),U=R.data,T=R.status;R.refetch;var V=U||{},W=V.list,X=V.pagination||{},Y=(X.total_pages,X.total_items),q=null==W?void 0:W.flatMap(function(e){return Object.entries(e.deployEnvironment||{}).map(function(n){var t=(0,l.Z)(n,2),r=t[0],o=t[1];return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach(function(n){(0,i.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({key:"".concat(e.id,"-").concat(r),name:o.deploymentName,deployEnvironment:r,app:{id:e.id,name:e.name,slug:e.slug},project:e.project},o)})});console.log({displayedDeployEnvironments:q});var B=(0,Z.x7)({pagination:{page:L,size:50}}),G=B.data;B.status;var H=(G||{}).list,J=[{title:"Deployment",width:30,dataIndex:"name",key:"name",fixed:null!=m&&m.md?"left":void 0,filterSearch:!0,render:function(e,n){var t,r;return(0,z.jsx)(x(),{href:"?lv1=deploy_environment&project=".concat(null===(t=n.project)||void 0===t?void 0:t.slug,"&app=").concat(null===(r=n.app)||void 0===r?void 0:r.slug,"&env=").concat(n.deployEnvironment),children:e})}},{title:"ENV",width:15,dataIndex:"deployEnvironment",key:"deployEnvironment",render:function(e){return(0,z.jsx)(p.Z,{color:"prod"===e?"success":"default",children:e})},filters:(0,I.Y)((null==q?void 0:q.map(function(e){return{text:e.deployEnvironment,value:e.deployEnvironment}}))||[]).filter(function(e,n,t){return n===t.findIndex(function(n){return n.value===e.value})}),onFilter:function(e,n){return n.deployEnvironment===e}},{title:"Project",width:30,dataIndex:"project",key:"project",render:function(e){return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("span",{children:e.name})," ",(0,z.jsx)(p.Z,{children:e.slug})]})},filters:(0,I.Y)(((null==q?void 0:q.map(function(e){var n,t,r,o;return{text:null!==(n=null===(t=e.project)||void 0===t?void 0:t.name)&&void 0!==n?n:"",value:null!==(r=null===(o=e.project)||void 0===o?void 0:o.slug)&&void 0!==r?r:""}}))||[]).filter(function(e){return""!==e.text&&""!==e.value})).filter(function(e,n,t){return n===t.findIndex(function(n){return n.value===e.value})}),onFilter:function(e,n){var t;return(null===(t=n.project)||void 0===t?void 0:t.slug)===e}},{title:"App",width:30,dataIndex:"app",key:"app",render:function(e){return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("span",{children:e.name})," ",(0,z.jsx)(p.Z,{children:e.slug})]})}},{title:"Cluster",width:30,dataIndex:"cluster",key:"cluster",render:function(e){return(0,z.jsx)(v.ZP,{type:"link",style:{padding:0},children:e})},filters:(0,I.Y)((null==H?void 0:H.map(function(e){return{text:e.name,value:e.slug}}))||[]).filter(function(e){return""!==e.text&&""!==e.value}),onFilter:function(e,n){return n.cluster===e}},{title:"CPU",dataIndex:"cpu",width:15,key:"cpu",render:function(e){return e?(0,z.jsx)(p.Z,{children:e}):"-"},sorter:function(e,n){return N.Su.indexOf(e.cpu||"")-N.Su.indexOf(n.cpu||"")}},{title:"Memory",dataIndex:"memory",key:"memory",width:15,render:function(e){return e?(0,z.jsx)(p.Z,{children:e}):"-"},sorter:function(e,n){return N.gM.indexOf(e.memory||"")-N.gM.indexOf(n.memory||"")}},{title:"Replicas",dataIndex:"replicas",key:"replicas",width:15},{title:"Last updated by",dataIndex:"lastUpdatedBy",key:"lastUpdatedBy",width:25,filterSearch:!0},{title:"Last updated",dataIndex:"updatedAt",key:"updatedAt",width:20,render:function(e){return(0,z.jsx)(E.q,{date:e})},sorter:function(e,n){return y()(e.updatedAt).diff(y()(n.updatedAt))}}],Q=(0,k.E_)(),$=(0,l.Z)(Q,2);$[0],$[1];var ee=(0,b._M)(),en=(0,l.Z)(ee,2);en[0],en[1];var et=(0,b.rg)(),er=(0,l.Z)(et,2);er[0],er[1];var eo=(0,b.WK)(),ei=(0,l.Z)(eo,2);ei[0],ei[1];var el=(0,b.md)(),ea=(0,l.Z)(el,2);ea[0],ea[1];var eu=(0,w.rA)(),ed=(0,l.Z)(eu,2);ed[0],ed[1];var ec=(0,w.fg)(),es=(0,l.Z)(ec,2);es[0],es[1];var ep=(0,O.GD)(),ev=(0,l.Z)(ep,2);ev[0],ev[1];var ef=(0,b.yq)(),em=(0,l.Z)(ef,2);em[0],em[1];var ey=(0,b.wt)(),eg=(0,l.Z)(ey,2);eg[0],eg[1];var ex=(0,b.kK)(),eh=(0,l.Z)(ex,2);eh[0],eh[1];var openNewApp=function(){var e=null==g?void 0:g.info({className:"!p-0",style:{padding:0},bodyStyle:{padding:0},icon:null,content:(0,z.jsx)(F.Z,{onClose:function(){return null==e?void 0:e.destroy()}}),footer:null,closable:!0,maskClosable:!0,onOk:function(){}})};(0,j.useEffect)(function(){e.isReady&&M(r.page?parseInt(r.page.toString(),10):1)},[r.page]);var ej=(0,j.useRef)(null),eb=(0,s.Z)(ej);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(P.Z,{commands:null==W?void 0:W.map(function(e){return{label:"".concat(e.name," (").concat(e.slug,")"),value:e,children:Object.keys(e.deployEnvironment||{}).map(function(n){return{value:e,label:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(p.Z,{children:e.slug}),"≫",(0,z.jsx)(p.Z,{children:n})]}),children:Object.keys(e.deployEnvironment||{}).map(function(n){return{label:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(a.Z,{}),"Deploy environment ≫ ".concat(n.toUpperCase())]}),value:(e.deployEnvironment||{})[n],onSelect:function(t){return o({lv1:"deploy_environment",project:e.slug,app:e.slug,env:n})}}})}})}})}),(0,z.jsx)(_.V,{title:"Deploy environments",breadcrumbs:[{name:"Workspace"}],actions:[(0,z.jsx)(v.ZP,{icon:(0,z.jsx)(u.Z,{className:"align-middle"}),href:"/import",children:"Import"},"import-btn"),(0,z.jsx)(v.ZP,{icon:(0,z.jsx)(d.Z,{className:"align-middle"}),onClick:function(){return openNewApp()},children:"Create app"},"create-app-btn")]}),(0,z.jsx)("div",{className:"h-full flex-auto overflow-hidden",ref:ej,children:(0,z.jsx)(f.Z,{size:"small",loading:"loading"===T,columns:J,dataSource:q,scroll:{x:null!=m&&m.md?1600:1200,y:void 0!==(null==eb?void 0:eb.height)?eb.height-120:void 0},sticky:{offsetHeader:0},pagination:{showSizeChanger:!0,current:L,defaultPageSize:K,total:Y,position:["bottomCenter"]},onChange:function(e){console.log("Table changed!");var n=e.current;o({page:null!=n?n:1})}})})]})},R=t(6761),U=t(1071),deploy_environment=function(){return(0,z.jsx)(o.Wk,{children:(0,z.jsx)(R.o,{meta:(0,z.jsx)(U.h,{title:"Deploy Environment",description:"Manage deploy environments across clusters"}),children:(0,z.jsx)(DeployEnvironmentList,{})})})}},49740:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deploy-environment",function(){return t(12117)}])}},function(e){e.O(0,[3662,5877,6043,3945,7786,9774,2888,179],function(){return e(e.s=49740)}),_N_E=e.O()}]);